#!/usr/bin/env ruby

require 'json'
require 'shellwords'

# FIXME: where am I mysteriously setting this???
ENV.delete('ROOSTER_FILE') if ENV.key?('ROOSTER_FILE')

logins = begin
           JSON.parse(`rooster export`)
         rescue Interrupt
           exit 1
         end

services = logins.map do |login|
  "#{login.fetch('name')} - #{login.fetch('username')}"
end.sort.join("\n")

selected = begin
             `echo #{services.shellescape} | selecta 2>/dev/null`.chomp
           rescue Interrupt
             exit 1
           end
name = selected.split(" - ").fetch(0)

begin
  system "rooster get #{name}"
rescue Interrupt
  exit 1
end
