#!/usr/bin/env ruby

# frozen_string_literal: true

require 'json'

path = File.expand_path('~/.working-directory-statistics.json')
wd = Dir.getwd

data =
  if File.exist?(path)
    JSON.parse File.read path
  else
    {}
  end

data[wd] ||= {}
data[wd]["count"] ||= 0
data[wd]["count"] += 1
data[wd]["first_visited_at"] ||= Time.now
data[wd]["last_visited_at"] = Time.now

data = data.sort_by { |path, statistics| -statistics["count"] }.to_h

File.write path, JSON.pretty_generate(data)
